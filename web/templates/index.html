<!DOCTYPE html>
<html lang="en-US">
    <head>
        <title>Worfometer</title>
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>
    <body>
        <div id="chartContainer" style="padding-left: 5%; width: 90%; height: 400px;">
        </div>
        <div id="textData">
            <p>{{total_rotations}} rotations in the last 24 hours.</p>
        </div>

        <script>
            const data = [
                {% for ii in datapoints%}[
                    moment.utc('{{ii[0]|dt_iso}}').toDate().getTime(),
                    {{ii[1]}}
                ],{% endfor %}
            ];

            const startTime = moment.utc('{{start_time|dt_iso}}');
            const endTime = moment.utc('{{end_time|dt_iso}}');

            document.addEventListener('DOMContentLoaded', function () {
                const chart = Highcharts.chart({
                    chart: {
                        renderTo: 'chartContainer',
                        type: 'line',
                        zoomType: 'x',
                    },
                    title: {
                        text: 'Hedgehog Spinnies',
                    },
                    xAxis: {
                        type: 'datetime',
                        min: startTime.toDate().getTime(),
                        max: endTime.toDate().getTime(),
                    },
                    yAxis: {
                        title: {
                            text:'Rotations per minute',
                        },
                        min: 0,
                    },
                    series: [{
                        type: 'area',
                        name: 'Rotations',
                        data: data,
                    }],
                    time: {
                        useUTC: false,
                    },
                    credits: {
                        enabled: false,
                    },
                });
            });
        </script>
    </body>
</html>
